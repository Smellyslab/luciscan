<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="block.css">
    <link rel="stylesheet" href="tx.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://unpkg.com/animate-css-grid@latest"></script>
</head>

<body>

    <header>
        <img class="Logo" id="Logo" src="/Assets/Logo.svg">
        <label for=""></label><input class="input" type="textbox" name="searchFor"
            placeholder="Search for Blocks or Transactions" onkeydown="search(this)"></input><br>
        <p class="nhr">Network Hashrate:</p>
        <p id="hashrate"></p>
    </header>

    <div id="grid-container" class="grid-container">
        <div class="grid-item">Height</div>
        <div class="grid-item">Txs</div>
        <div class="grid-item">Block Hash</div>
        <div class="grid-item">Age</div>
    </div>

    <div id="grid-container-block-wrapper" class="grid-container-block-wrapper">
        <div id="grid-container-block-section1" class="grid-container-block-section1">
            <div id="grid-item-block-Block" class="grid-item-block-section1" style="font-weight: 400; font-size: 20px">
                Block: </div>
            <div id="grid-item-block-Hash" class="grid-item-block-section1"
                style="font-family: 'CascadiaCode'; font-weight: 200; font-size: 16px; padding-top: 27px">Hash: </div>
            <div id="grid-item-block-Size" class="grid-item-block-section1" style="font-weight: 400; font-size: 19px">
                Size: </div>
            <div id="grid-item-block-SizekB" class="grid-item-block-section1" style="font-weight: 400; font-size: 19px">
            </div>
            <div id="grid-item-block-Reward" class="grid-item-block-section1" style="font-weight: 400; font-size: 19px">
                Block Reward: </div>
            <div id="grid-item-block-RewardAmount" class="grid-item-block-section1"
                style="font-weight: 400; font-size: 19px"></div>
            <div id="grid-item-block-Coinbase" class="grid-item-block-section1"
                style="font-weight: 400; font-size: 19px">Coinbase Tx: </div>
            <div id="grid-item-block-CBHash" class="grid-item-block-section1"
                style="font-family: 'CascadiaCode'; font-weight: 200; font-size: 16px; padding-top: 27px"></div>
        </div>

        <div id="grid-container-block-section2" class="grid-container-block-section2">
            <div id="grid-item-block-Transactions" class="grid-item-block-section2"
                style="font-weight: 300; font-size: 20px"></div>
        </div>
    </div>

    -->

    <div id="grid-container-tx-wrapper" class="grid-container-tx-wrapper">
        <div id="grid-container-tx-section1" class="grid-container-tx-section1">
            <div id="grid-item-tx-Transactions" class="grid-item-tx-section1" style="font-weight: 300; font-size: 20px">
                Transaction Details:</div>
            <div id="grid-item-tx-age" class="grid-item-tx-section1">2021-21-03 13:03:01</div>
        </div>
        <div id="grid-container-tx-section2" class="grid-container-tx-section2">
            <div id="grid-item-tx-Hash" class="grid-item-tx-section2">Hash: </div>
            <div id="grid-item-tx-txHash" class="grid-item-tx-section2"></div>
            <div id="grid-item-tx-extra" class="grid-item-tx-section2">Extra: </div>
            <div id="grid-item-tx-extra2" class="grid-item-tx-section2"></div>
        </div>
        <div id="grid-container-tx-section3" class="grid-container-tx-section3">
            <div id="grid-item-tx-Block" class="grid-item-tx-section2">Block: </div>
            <div id="grid-item-tx-BlockNumber" class="grid-item-tx-section2"></div>
            <div id="grid-item-tx-Ring" class="grid-item-tx-section2">Ring Size: </div>
            <div id="grid-item-tx-RingSize" class="grid-item-tx-section2"></div>
            <div id="grid-item-tx-Fee" class="grid-item-tx-section3">Fee/Size: </div>
            <div id="grid-item-tx-FeeSize" class="grid-item-tx-section3"></div>
            <div id="grid-item-tx-Confirmations" class="grid-item-tx-section3">Confirmations: </div>
            <div id="grid-item-tx-ConfirmationsAmount" class="grid-item-tx-section3"></div>
        </div>
        <div id="grid-container-tx-section4" class="grid-container-tx-section4">
            <div id="grid-item-tx-inputs" class="grid-item-tx-section4">Inputs: </div>
        </div>

        <div id="grid-container-tx-section6" class="grid-container-tx-section6">
            <div id="grid-item-tx-inputs" class="grid-item-tx-section6">Outputs: </div>
        </div>

    </div>

    <div id="backButton" onclick="showBlocks();">
        <img id="backButtonSVG" src="/Assets/backArrow.svg">
    </div>

    <div id="homeButton" onclick="home();setTimeout(removeTxList, 100);">
        <img id="homeButtonSVG" src="/Assets/home.svg">
    </div>


</body>

<script>
    const grid = document.querySelector(".grid-container");
    animateCSSGrid.wrapGrid(grid, { duration: 50, easing: 'linear' });
</script>

<script>
    var height;
    var hashrate;
    var scrollY = 0;

    $(window).on("load", $('#grid-container').addClass('active'));
    //$(window).on("load", $('#grid-container-tx-wrapper').addClass('active'));

    $.getJSON(`https://localmonero.co/blocks/api/get_stats`, function (initialize) {
        height = initialize.height;
        hashrate = initialize.hashrate;
        Math.trunc(hashrate);
        hashrateMhs = hashrate / 1000000;

        document.getElementById("hashrate").innerHTML = hashrateMhs.toFixed(2).concat(" Mh/s");

        const fetchBlocks = async () => {
            for (let i = height; i >= (height - 25); i--) {
                await blockHeight(i);
            }
        };

        const blockHeight = async id => {
            const url = `https://monero.mycryptoapi.com/api/block/${id}`;
            const data = await fetch(url);
            const block = await data.json();
            $("#grid-container").append(`<div class="grid-item" style ="font-weight: 400; font-size: 19px">${block.data.block_height}</div>`);
            $("#grid-container").append(`<div class="grid-item" style ="font-size: 19px">${(block.data.txs.length) - 1}</div>`);
            $("#grid-container").append(`<div class="grid-item hashHover" style="font-family: 'CascadiaCode'; font-weight: 200; font-size: 16px; padding-top: 24px; cursor: pointer" onclick="showBlock('${block.data.hash}');setTimeout(temp, 100);">${block.data.hash}</div>`);
            $("#grid-container").append(`<div class="grid-item" style ="font-weight: 300; font-size: 16px; padding-top: 22.5px; color: #898989">${moment.unix(block.data.timestamp).startOf('seconds').fromNow()}</div>`);
        };
        fetchBlocks();
    });

    function showBlock(blockInput) {

        const getBlock = async () => {
            await blockData(blockInput);
        };

        const blockData = async blockInput => {
            const url2 = `https://monero.mycryptoapi.com/api/block/${blockInput}`;
            const data2 = await fetch(url2);
            const block2 = await data2.json();
            var temp;
            document.getElementById("grid-item-block-Block").innerHTML = ("Block: ").concat(block2.data.block_height);
            document.getElementById("grid-item-block-Hash").innerHTML = ("Hash: ").concat(block2.data.hash);
            document.getElementById("grid-item-block-SizekB").innerHTML = ((block2.data.size) / 1000).toString().concat(" kB");
            document.getElementById("grid-item-block-Coinbase").innerHTML = ("Coinbase Tx: ");
            document.getElementById("grid-item-block-CBHash").innerHTML = block2.data.txs[0].tx_hash;
            document.getElementById("grid-item-block-RewardAmount").innerHTML = ((block2.data.txs[0].xmr_outputs) / 1000000000000).toString().concat(" XMR");
            document.getElementById("grid-item-block-Transactions").innerHTML = (block2.data.txs.length - 1).toString().concat(" Transactions: ");
            $('<div/>', { id: 'grid-container-block', "class": 'grid-container-block', }).appendTo('#grid-container-block-section1');
            $("#grid-container-block").append(`<div class="grid-item-block" style ="font-weight: 400; font-size: 19px">Hash</div>`);
            $("#grid-container-block").append(`<div class="grid-item-block" style="font-weight: 400; font-size: 19px">Size</div>`);
            for (let i = 1; i < block2.data.txs.length; i++) {
                temp = block2.data.txs[i].tx_hash;
                $("#grid-container-block").append(`<div class="grid-item-block" style="font-family: 'CascadiaCode'; font-weight: 200; font-size: 16px; padding-top: 24px;" onclick="showTx('${block2.data.txs[i].tx_hash}');temp2()">${block2.data.txs[i].tx_hash}</div>`);
                $("#grid-container-block").append(`<div class="grid-item-block" style ="font-weight: 400; font-size: 19px">${(block2.data.txs[i].tx_size) / 1000} kB</div>`);
            }
        };
        getBlock();
    }

    function showTx(txInput) {

        const getTx = async () => {
            await txData(txInput);
        };

        const txData = async txInput => {
            const url3 = `https://monero.mycryptoapi.com/api/transaction/${txInput}`;
            const data3 = await fetch(url3);
            const block3 = await data3.json();

            document.getElementById("grid-container-tx-section6").style.top = (768 + (block3.data.inputs.length) * 72);

            document.getElementById("grid-item-tx-txHash").innerHTML = txInput;
            document.getElementById("grid-item-tx-age").innerHTML = block3.data.timestamp_utc;
            if (block3.data.extra.length >= 88) {
                document.getElementById("grid-item-tx-extra2").innerHTML = block3.data.extra.toString().substr(0, 87).concat("...");
            } else {
                document.getElementById("grid-item-tx-extra2").innerHTML = block3.data.extra;
            }
            document.getElementById("grid-item-tx-BlockNumber").innerHTML = block3.data.block_height;
            document.getElementById("grid-item-tx-RingSize").innerHTML = block3.data.mixin;
            document.getElementById("grid-item-tx-FeeSize").innerHTML = ((block3.data.tx_fee) / 1000000000000).toString().concat(" per kB / ") + ((block3.data.tx_size) / 1000).toString().concat(" kB");
            document.getElementById("grid-item-tx-ConfirmationsAmount").innerHTML = block3.data.confirmations;
            $('<div/>', { id: 'grid-container-tx-section5', "class": 'grid-container-tx-section5', }).appendTo('#grid-container-tx-wrapper');
            $("#grid-container-tx-section5").append(`<div class="grid-item-tx-section5">Key Image: </div>`);
            $('<div/>', { id: 'grid-container-tx-section7', "class": 'grid-container-tx-section7', }).appendTo('#grid-container-tx-wrapper');
            $("#grid-container-tx-section7").append(`<div class="grid-item-tx-section7">Stealth Address: </div>`);
            document.getElementById("grid-container-tx-section7").style.top = (808 + (block3.data.inputs.length) * 72);

            for (let i = 0; i < block3.data.inputs.length; i++) {
                $("#grid-container-tx-section5").append(`<div class="grid-item-tx-section5">${block3.data.inputs[i].key_image}</div>`);
            }
            for (let i = 0; i < block3.data.outputs.length; i++) {
                $("#grid-container-tx-section7").append(`<div class="grid-item-tx-section7">${block3.data.outputs[i].public_key}</div>`);
            }

            $('.grid-container-tx-wrapper').addClass('active');
        };
        getTx();
    }

    function temp() {
        $('#grid-container').removeClass('active');
        $('#backButton').addClass('active');
        //$('#homeButton').addClass('active');
        $('#grid-container-block-wrapper').addClass('active');
        scrollY = window.pageYOffset;
        $("html, body").animate({ scrollTop: "0px" });
        $(window).on("load", $('#grid-container-tx-wrapper').removeClass('active'));
        $('#grid-container-tx-section5').remove();
        $('#grid-container-tx-section7').remove();
    }

    function temp2() {
        $('#grid-container').removeClass('active');
        $('#backButton').addClass('active');
        $('#homeButton').addClass('active');
        $('#grid-container-block-wrapper').removeClass('active');
        $('#grid-container-tx-wrapper').addClass('active');
        $("html, body").animate({ scrollTop: "0px" });

    }

    function showBlocks() {

        if ($('#grid-container-block-wrapper').hasClass('active')) {
            $('#grid-container').addClass('active');
            $('#backButton').removeClass('active');
            $('#homeButton').removeClass('active');
            $('#grid-container-tx-wrapper').removeClass('active');
            $('#grid-container-block-wrapper').removeClass('active');
            setTimeout(removeTxList, 100);
            $('#grid-container-tx-section5').remove();
            $('#grid-container-tx-section7').remove();
            $("html, body").animate({ scrollTop: scrollY.toString().concat("px") });
        } else {
            $('#homeButton').removeClass('active');
            $('#grid-container-block-wrapper').addClass('active');
            $('#grid-container-tx-wrapper').removeClass('active');
            $('#grid-container-tx-section5').remove();
            $('#grid-container-tx-section7').remove();
            $("html, body").animate({ scrollTop: scrollY.toString().concat("px") });
        }
    }

    function home() {
        $('#backButton').removeClass('active');
        $('#homeButton').removeClass('active');
        $('#grid-container-block-wrapper').removeClass('active');
        $('#grid-container-tx-wrapper').removeClass('active');
        $('#grid-container').addClass('active');
        $("html, body").animate({ scrollTop: scrollY.toString().concat("px") });
    }

    function removeTxList() {
        $(".grid-container-block").remove();
    }

    $(window).scroll(function () {
        const backButton = document.getElementById("backButton");
        const homeButton = document.getElementById("homeButton");
        var style = getComputedStyle(backButton);
        var style2 = getComputedStyle(homeButton);
        var buttonTop = style.top;
        var homeTop = style.top;
        var currentPos = window.pageYOffset;
        if (currentPos < 120) {
            backButton.style.top = "266px";
            homeButton.style.top = "336px";
        }
        else {
            backButton.style.top = "50px";
            homeButton.style.top = "120px";
        }
    })

    function search(ele) {
        if (event.key === 'Enter') {
            var inputText = ele.value.trim();

            $.getJSON(`https://monero.mycryptoapi.com/api/block/${inputText}`, function (block) {
                if (block.data.hash != undefined) {
                    removeTxList();
                    showBlock(`${inputText}`);
                    temp();
                } else {
                    $.getJSON(`https://monero.mycryptoapi.com/api/transaction/${inputText}`, function (block2) {
                        if (block2.data.confirmations != undefined) {
                            $('#grid-container-tx-section5').remove();
                            $('#grid-container-tx-section7').remove();
                            showTx(`${inputText}`);
                            temp2();
                        } else {
                            alert("xd");
                        }
                    });
                }
            });
        }
    }

</script>

</html>